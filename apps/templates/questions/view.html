{% extends "base.html" %}

{% block extra_js %}
{{ modules.Static("js/question_actions.js") }}
{% end %}

{% block content_inner %}

<div style="float:right;width:45%">

{% if is_admin_user %}
<div id="question_actions">
  <h3>Admin actions</h3>
  {% if question.submit_date %}
  <form action="{{ reverse_url('reject_question', question._id) }}" method="post" id="reject">
    {{ xsrf_form_html() }}
    <div id="reject_comment" style="display:none">Comment:<br>
    <textarea name="reject_comment" cols="30" rows="3"></textarea>
    </div>
    <div><input type="submit" value="Reject"></div>
  </form>
  {% if question.accept_date %}
    {% if skip is not None %}
      <form action="{{ reverse_url('review_accepted') }}" method="post" id="skip">
        {{ xsrf_form_html() }}
        <div><input type="hidden" name="skip" value="{{ skip }}">
        <input type="submit" value="Skip"></div>
      </form>
    {% end %}

    <form action="{{ reverse_url('publish_question', question._id) }}" method="post" id="publish">
      {{ xsrf_form_html() }}
      <div><input type="submit" value="Publish!"></div>
    </form>

  {% else %}
    <form action="{{ reverse_url('accept_question', question._id) }}" method="post" id="accept">
      {{ xsrf_form_html() }}
      <div><input type="submit" value="Accept"></div>
    </form>
  {% end %}
  {% else %}
  <p><em>Question not submitted yet</em></p>
  {% end %}
</div>
{% end %}

{% if question.accept_date %}
<div id="question_reviews">
<h3>Reviews</h3>
<table style="width:100%">
  <thead>
  <tr>
    <td>Verdict</td>
    <td>Reviewer</td>
    <td>Difficulty</td>
    <td>Rating</td>
  </tr>
  </thead>
  {% if rating_total %}
  <tfoot>
  <tr>
    <td colspan="2">TOTALS:</td>
    <td>{{ difficulty_total }}</td>
    <td>{{ rating_total }}</td>
  </tr>
  </tfoot>
  {% end %}
  {% for review in reviews %}
  <tbody class="review">
    <tr>
      <td><strong>{{ review.verdict }}</strong></td>
      <td>{{ modules.ShowUser(review.user) }}</td>
      <td>{{ review.difficulty }}</td>
      <td>{{ review.rating }}</td>
    </tr>
  </tbody>
  {% end %}
</table>
</div>
{% else %}
<p>No reviews at the moment because the question isn't accepted yet.</p>
{% end %}

</div>

<div id="question_info">
<p>
<strong>Question:</strong>
<span>{{ question.text }}</span>
<br>
<strong>Answer:</strong>
<span>{{ question.answer }}</span>
({% if question.spell_correct %}spell correct{% else %}no spell correction{% end %})
<br>
<strong>Also accept:</strong>
{% if question.accept %}
<span>{{ ', '.join(question.accept) }}</span>
{% else %}
<em>none</em>
{% end %}
<br>
<strong>Alternatives:</strong>
<span>{{ ', '.join(question.alternatives) }}</span>
<br>
<strong>Comments:</strong>
{% if question.comment %}
<span>{{ question.comment }}</span>
{% else %}
<em>none</em>
{% end %}
</p>
</div>

<div id="question_metadata">
<p>
<strong>By:</strong>
<span>{{ modules.ShowUser(question.author) }}</span>
<br>
{% if question.submit_date %}
<strong>Submitted:</strong>
<span>{{ modules.TimeSince(question.submit_date) }} ago</span>
<br>
{% end %}
{% if question.reject_date %}
<strong>Rejected:</strong>
<span>{{ modules.TimeSince(question.reject_date) }} ago</span>
<br>
{% if question.reject_comment %}
<strong>Rejection comment:</strong>
<span><em>{{ question.reject_comment }}</em></span>
<br>
{% end %}
{% end %}
{% if question.accept_date %}
<strong>Accepted:</strong>
<span>{{ modules.TimeSince(question.accept_date) }} ago</span>
<br>
{% end %}
{% if question.publish_date %}
<strong>Published:</strong>
<span>{{ modules.TimeSince(question.publish_date) }} ago</span>
<br>
{% end %}
</p>
</div>

<p><a href="/questions/" class="btn">&larr; back to questions dashboard</a></p>



{% end %}