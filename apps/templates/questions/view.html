{% extends "base.html" %}

{% block extra_js %}
{{ modules.Static("js/question_actions.js") }}
{% end %}

{% block content_inner %}

<div id="question_actions">
{% if is_admin_user %}
<h4>Admin actions</h4>
<form action="{{ reverse_url('reject_question', question._id) }}" method="post" id="reject">
{{ xsrf_form_html() }}
<div id="reject_comment" style="display:none">Comment:<br>
<textarea name="reject_comment" cols="30" rows="3"></textarea>
</div>
<div><input type="submit" value="Reject"></div>
</form>
{% if question.accept_date %}
{% if skip is not None %}
<form action="{{ reverse_url('review_accepted') }}" method="post" id="skip">
{{ xsrf_form_html() }}
<div><input type="hidden" name="skip" value="{{ skip }}">
<input type="submit" value="Skip"></div>
</form>
{% end %}
<form action="{{ reverse_url('publish_question', question._id) }}" method="post" id="publish">
{{ xsrf_form_html() }}
<div><input type="submit" value="Publish!"></div>
</form>
{% else %}
<form action="{{ reverse_url('accept_question', question._id) }}" method="post" id="accept">
{{ xsrf_form_html() }}
<div><input type="submit" value="Accept"></div>
</form>
{% end %}

<h4>Reviews</h4>
<div id="reviews">
{% for review in reviews %}
<div class="review">
  <div class="rating">
    <p>{{ review.rating }}</p>
  </div>
  <div class="verdict_and_comment">
    <p class="verdict"><strong>{{ review.verdict }}</strong>
    {{ modules.ShowUser(review.user) }}
    </p>
    {% if review.comment %}
    {{ modules.RenderText(review.comment) }}
    {% end %}
  </div>
</div>
{% end %}
{% if rating_total %}
  <div class="review">
    <div class="rating">
      <p>TOTAL: {{ rating_total }}</p>
    </div>
  </div>
{% end %}
</div>

{% end %}
</div>

<div id="question_info">
<p>
<strong>Question:</strong>
<span>{{ question.text }}</span>
<br>
<strong>Answer:</strong>
<span>{{ question.answer }}</span>
({% if question.spell_correct %}spell correct{% else %}no spell correction{% end %})
<br>
<strong>Also accept:</strong>
{% if question.accept %}
<span>{{ ', '.join(question.accept) }}</span>
{% else %}
<em>none</em>
{% end %}
<br>
<strong>Alternatives:</strong>
<span>{{ ', '.join(question.alternatives) }}</span>
<br>
<strong>Comments:</strong>
{% if question.comment %}
<span>{{ question.comment }}</span>
{% else %}
<em>none</em>
{% end %}
</p>
</div>

<div id="question_metadata">
<p>
<strong>By:</strong>
<span>{{ modules.ShowUser(question.author) }}</span>
<br>
<strong>Submitted:</strong>
<span>{{ modules.TimeSince(question.submit_date) }} ago</span>
<br>
{% if question.reject_date %}
<strong>Rejected:</strong>
<span>{{ modules.TimeSince(question.reject_date) }} ago</span>
<br>
{% if question.reject_comment %}
<strong>Rejection comment:</strong>
<span><em>{{ question.reject_comment }}</em></span>
<br>
{% end %}
{% end %}
{% if question.accept_date %}
<strong>Accepted:</strong>
<span>{{ modules.TimeSince(question.accept_date) }} ago</span>
<br>
{% end %}
{% if question.publish_date %}
<strong>Published:</strong>
<span>{{ modules.TimeSince(question.publish_date) }} ago</span>
<br>
{% end %}
</p>
</div>

{% end %}